import numpy as np
import scipy.sparse
import kmeans
import matplotlib.pyplot as plt
from scipy.spatial import distance
#Define the data directory (change if you place data elsewhere)
data_dir = "/rahul_extra/MachineLearning/Kaggle/hw4/data/" 

#Load the training ratings
A       = np.load(data_dir + "train.npy")
A.shape = (1,)
Xtrain  = A[0]

#Load the validation ratings
A       = np.load(data_dir + "validate.npy")
A.shape = (1,)
Xval    = A[0]

#Load the test ratings
A       = np.load(data_dir + "test.npy")
A.shape = (1,)
Xtest   = A[0]

#Load the user, item, and genre information
Users   = np.load(data_dir + "users.npy")
Items   = np.load(data_dir + "items.npy")
Genres  = np.load(data_dir + "genres.npy")


def train_model(k=2):

	#Train k-Means on the training data
	#k=2
	model = kmeans.kmeans(n_clusters=k)
	model.fit(Xtrain)

	#Predict back the training ratings and compute the RMSE
	XtrainHat = model.predict(Xtrain,Xtrain)
	tr= model.rmse(Xtrain,XtrainHat)

	#Predict the validation ratings and compute the RMSE
	XvalHat = model.predict(Xtrain,Xval)
	val= model.rmse(Xval,XvalHat)

	#Predict the test ratings and compute the RMSE
	#XtestHat = model.predict(Xtrain,Xtest)
	#te= model.rmse(Xtest,XtestHat)

	#Get the cluster assignments for the training data
	#z = model.cluster(Xtrain)
	#print(z)

	#Get the clusters 
	#centers = model.get_centers()
	#print(centers)

	#print("K=%d Errors: %.7f %.7f "%(k,tr,val))
	return (tr,val)

def cal_vt(final_result):
	final_t = []
	final_v = []
	for i in range(len(final_result)):
	    print "Step", i 
	    t = []
	    val = []
	    for j in final_result[i]:
	        t.append(j[0])
	        val.append(j[1])
	    t.sort(reverse=True)
	    val.sort(reverse=True)
	    print "Training Set"
	    print "max => ",t[0]
	    print "min =>",t[-1]
	    print "avg =>", sum(t)/len(t)
	    final_t.append([t[0],t[-1],sum(t)/len(t)])

	    print "Validation Set"
	    print "max =>",val[0]
	    print "min =>",val[-1]
	    print "avg =>",sum(val)/len(val)
	    final_v.append([val[0],val[-1],sum(val)/len(val)])
	    print "-------------------------------------------------------"
	return final_t,final_v


def plot(maxv,minv,avg):
	plt.style.use('ggplot')
	x = range(1,11)
	#plt.plot(x,maxv,label='max')
	plt.plot(x,avg,label='Average RMSE')
	#plt.plot(x,avg,label='avg')
	
	#ploting straingt line 
	local = [avg[0],avg[-1]]
	plt.plot([1,10], local)

	#calculate max distance by plotting straight line 
	maxd = 0
	pt1 = 0
	pt2 = 0
	for x in range(1,len(avg)):
		#y = -0.01*x  + 1  #Equation of st line calculated for test set
		y = 0.001*x + 1.034 #Equation for validation set
		a = np.array([x,avg[x-1]])
		b = np.array([x,y])
		#dist = distance.euclidean(a,b)
		dist = np.fabs(y - avg[x-1])
		print "distance is ",dist
		if maxd < dist:
			maxd = dist
			pt1 = a
			pt2 = b
			print "iterim max distance",maxd , pt1, pt2

	print "Max distance between points ", maxd 
	print "points are", pt1 ,pt2

	#plotting the maximum distance between the 2 points 
	plt.scatter(pt1[0],pt1[1],s=40)


	plt.legend()
	plt.show()

'''
#rl is range list for the 'k' clusters. 
rl = range(1,11)
final_result = []
for i in rl:
	iresult = []
	for j in range(0,10):
		print "Iteration =>",j
		result = train_model(i)
		iresult.append(result)
	final_result.append(iresult)

print "the final result is",final_result
'''
final_result = [[(0.9966367263864635, 1.0366734384117333), (0.9966367263864635, 1.0366734384117333), (0.9966367263864635, 1.0366734384117333), (0.9966367263864635, 1.0366734384117333), (0.9966367263864635, 1.0366734384117333), (0.9966367263864635, 1.0366734384117333), (0.9966367263864635, 1.0366734384117333), (0.9966367263864635, 1.0366734384117333), (0.9966367263864635, 1.0366734384117333), (0.9966367263864635, 1.0366734384117333)], [(0.93781913881324708, 1.0132798285866869), (0.93834411554672204, 1.0096441848442321), (0.95089475197066475, 1.0160223159086577), (0.93802489087358476, 1.0106513916603592), (0.93831861316784759, 1.0092057449475178), (0.93803975636622039, 1.0075230788297789), (0.93781703086725154, 1.0106781356464085), (0.93802204503872399, 1.0121972923611087), (0.95191936441519198, 1.0192909430479236), (0.93803981187492691, 1.0100384656294255)], [(0.91649168469501163, 1.0116056166508591), (0.91811654362614004, 1.004096688713308), (0.92453581499963744, 1.0202344340339256), (0.9195075763056938, 1.0130868217664188), (0.9221869496084476, 1.0148566672798387), (0.91466002547768332, 1.0003056897782787), (0.91975214634982105, 1.0164530139907726), (0.92105390352425442, 1.0206794934961325), (0.91923514504777926, 1.0064055047355376), (0.92255670341193174, 1.0055706501262807)], [(0.90974186427761106, 1.012527282845459), (0.89939877048676209, 1.0191111414152791), (0.90560941266789274, 1.0179305400772909), (0.90986713583050627, 1.0132422941267123), (0.90642660710188583, 1.0147675256501527), (0.908496851463508, 1.0205994409015382), (0.91459798464615294, 1.022751452135291), (0.90625720296550971, 1.0185996722375665), (0.90717159738263808, 1.0175335332653397), (0.90706067713604388, 1.0283351161115819)], [(0.89601793192325285, 1.0285691552203029), (0.89784189625999522, 1.0168100617634181), (0.90257961067292292, 1.0281341312266086), (0.90391655749712618, 1.0297157221817907), (0.91137582746817014, 1.0283165478490977), (0.90316367508806172, 1.0400336879453362), (0.9007983711650499, 1.0175652817466883), (0.89874098428548554, 1.0193980588940332), (0.89439035632508312, 1.0211900998228725), (0.89288703823300009, 1.0147031214202362)], [(0.89370086862942022, 1.0283184928613462), (0.89144546439300953, 1.0207163731692472), (0.88654297723196374, 1.0324019982221639), (0.89158563425423287, 1.0275971589772326), (0.89410170309545456, 1.0246226747885805), (0.89573986883886747, 1.0198532975058812), (0.89323638743140921, 1.0319056223519485), (0.89799245014047824, 1.037288783281596), (0.89770149295951029, 1.031302207579468), (0.89191789683954026, 1.0287211469453483)], [(0.88446010953691812, 1.0416477841207203), (0.88560574640397571, 1.0293563050051655), (0.88205755159670951, 1.0311496233135233), (0.88606234902292336, 1.0370753882388832), (0.88493975758692001, 1.0386633627685311), (0.89209451686496599, 1.0364685616792133), (0.88644315254843198, 1.02481771405157), (0.88696220911745327, 1.0259034093637462), (0.88462434443095306, 1.0328602640407365), (0.89046850550149792, 1.0386091254562813)], [(0.88967162927982835, 1.0391189003267858), (0.88753790812784661, 1.0357701806915156), (0.87888678074197746, 1.0335978833038115), (0.8809592043560911, 1.0481153696094494), (0.877702330476409, 1.0348681657941976), (0.8796320069520257, 1.0412206130163983), (0.87905002181999936, 1.042026303279348), (0.874925742752105, 1.0299670503181155), (0.87963606896505175, 1.0425902464198937), (0.88321181230062196, 1.0465185125675067)], [(0.87167306700260028, 1.0408078143152233), (0.87777180524300413, 1.044166988174156), (0.86959676709027212, 1.0403286255078126), (0.88159318735034164, 1.0421027415594299), (0.88101155023464772, 1.0527056824191441), (0.88115318639743268, 1.0358523090819214), (0.87873982607378354, 1.0443715162051861), (0.88330149290218762, 1.0489316822467178), (0.87327317367057156, 1.0362054035664803), (0.8815117818512761, 1.0456551248016031)], [(0.87117797369100436, 1.0393463345029115), (0.88093909583188534, 1.0454356622448466), (0.87866007152991243, 1.0539443015875234), (0.86403793547101904, 1.0434387656304664), (0.86948368583597568, 1.0537110453905336), (0.86606490760054755, 1.0444605049837843), (0.86839851953138025, 1.0468130430116376), (0.87326552635388477, 1.0377500631394523), (0.87014777330542459, 1.0398035275540636), (0.86669327748946046, 1.0493158748722728)]]

final_t,final_v = cal_vt(final_result)

max_t = [ i[0] for i in final_v]
min_t = [ i[1] for i in final_v]
avg = [i[2] for i in final_v]

plot(max_t, min_t, avg)


